name: Rust

on:
  push:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: jitterbit/get-changed-files@v1
      id: abc
      with:
        format: csv
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Create files
      run: |
        sudo apt install pandoc
        FILE=./createfiles
        if [ ! -f "$FILE" ]; then
          cargo build --release
          cp ./target/release/createfile ./
          git config --local user.name "MoreTacos"
          git add $FILE
          git add ./pages/*
          git commit -m "Add createfile"
          rm -rf ./target
        fi
        $FILE
        
    - name: Send curl
      run: |
        sudo apt install pandoc
        FILE=./sendcurl
        if [ ! -f "$FILE" ]; then
          cargo build --release
          cp ./target/release/sendcurl ./
          git config --local user.name "MoreTacos"
          git add $FILE
          git commit -m "Add sendcurl"
          rm -rf ./target
        fi
        $FILE ${{ steps.abc.outputs.added_modified }}
   
    - name: Push changes # push the output folder to your repo
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        force: true
